"use strict";

sap.ui.define("com/uniorg/cf/banking/example/controller/accountSales/AccountSales.controller", ["sap/ui/model/json/JSONModel", "sap/ui/model/Filter", "sap/ui/model/Sorter", "com/uniorg/cf/banking/example/utils/Formatter", "com/uniorg/cf/banking/example/controller/BaseController"], function (JSONModel, Filter, Sorter, Formatter, BaseController) {
	"use strict";

	return BaseController.extend("com.uniorg.cf.banking.example.controller.accountSales.AccountSales", {
		_oResponsivePopover: null,
		startDate: new Date(moment().subtract(5, 'month').startOf('month')),
		endDate: new Date(),
		actualIban: null,
		formatter: Formatter,
		onInit: function onInit() {
			var oRouter = sap.ui.core.UIComponent.getRouterFor(this);
			oRouter.getRoute("accountSalesIban").attachPatternMatched(this._onObjectMatched, this);

			var oJSONModel = new JSONModel();
			this.getView().setModel(oJSONModel);
			var oJSONModelAccounts = new JSONModel();
			this.getView().setModel(oJSONModelAccounts, "accounts");

			var dateFrom = new Date();
			dateFrom.setUTCDate(2);
			dateFrom.setUTCMonth(1);
			dateFrom.setUTCFullYear(2014);

			var dateTo = new Date();
			dateTo.setUTCDate(17);
			dateTo.setUTCMonth(1);
			dateTo.setUTCFullYear(2014);

			var oModel = new JSONModel();
			oModel.setData({
				delimiterDRS1: "@",
				dateValueDRS1: dateFrom,
				secondDateValueDRS1: dateTo,
				dateFormatDRS1: "yyyy/MM/dd",
				dateValueDRS2: new Date(moment().subtract(6, 'month').startOf('month')),
				secondDateValueDRS2: new Date(),
				dateMinDRS2: new Date(moment().subtract(6, 'month').startOf('month')),
				dateMaxDRS2: new Date(),
				ranges: {
					'Today': [moment(), moment()],
					'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
					'Last 7 Days': [moment().subtract(6, 'days'), moment()],
					'Last 30 Days': [moment().subtract(29, 'days'), moment()],
					'This Month': [moment().startOf('month'), moment().endOf('month')],
					'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
				}
			});
			this.getView().setModel(oModel, "dateSelect");
			this._iEvent = 0;
			this._loadInfoData(function () {});
			var that = this;
			if (!this._oResponsivePopover) {
				this._oResponsivePopover = sap.ui.xmlfragment("com.uniorg.cf.banking.example.fragments.SortPopover", this);
				this._oResponsivePopover.setModel(this.getView().getModel());
			}
			var oTable = this.getView().byId("accountSalesTable");
			var oItems = oTable.getBinding("items");
			var oSorter = new Sorter("valueDate", true);
			oItems.sort(oSorter);
			oTable.addEventDelegate({
				onAfterRendering: function onAfterRendering() {
					console.log(this);
					var oHeader = $("#" + this.sId).find('.sapMListTblHeaderCell'); //Get hold of table header elements
					console.log(oHeader);
					for (var i = 0; i < oHeader.length; i++) {
						var oID = oHeader[i].id;
						that.onClickSort(oID);
					}
				}
			}, oTable);
		},
		_onObjectMatched: function _onObjectMatched(oEvent) {
			console.log(oEvent.getParameter("arguments").iban);
		},
		handleDateSelectChange: function handleDateSelectChange(oEvent) {
			var sFrom = oEvent.getParameter("from");
			var sTo = oEvent.getParameter("to");
			var bValid = oEvent.getParameter("valid");
			this._iEvent++;

			if (bValid) {
				this.startDate = new Date(sFrom);
				this.endDate = new Date(sTo);
				this.getView().getModel("dateSelect").setProperty("/dateValueDRS2", new Date(sFrom));
				this.getView().getModel("dateSelect").setProperty("/secondDateValueDRS2", new Date(sTo));
				this.loadData();
			}
		},
		onClickSort: function onClickSort(oID) {
			var that = this;
			$('#' + oID).click(function (oEvent, b) {
				//Attach Table Header Element Event
				var oTarget = oEvent.currentTarget; //Get hold of Header Element
				var sort = $(oTarget).data("sort");
				console.log(sort);
				var oLabelText = oTarget.childNodes[0].textContent; //Get Column Header text
				var oIndex = oTarget.id.slice(-1); //Get the column Index
				var oView = that.getView();
				var oTable = oView.byId("accountSalesTable");
				var oModel = oTable.getModel().getProperty("/transactions"); //Get Hold of Table Model Values

				var oKeys = Object.keys(oModel[0]); //Get Hold of Model Keys to filter the value

				oView.getModel().setProperty("/bindingValue", sort); //Save the key value to property
				that._oResponsivePopover.openBy(oTarget);
			});
		},
		onChange: function onChange(oEvent) {
			var oValue = oEvent.getParameter("value");
			var oMultipleValues = oValue.split(",");
			var oTable = this.getView().byId("accountSalesTable");
			var oBindingPath = this.getView().getModel().getProperty("/bindingValue"); //Get Hold of Model Key value that was saved
			var aFilters = [];
			console.log(oBindingPath);
			for (var i = 0; i < oMultipleValues.length; i++) {
				var oFilter = new Filter(oBindingPath, "Contains", oMultipleValues[i]);
				aFilters.push(oFilter);
			}
			var oItems = oTable.getBinding("items");
			oItems.filter(aFilters, "Application");
			this._oResponsivePopover.close();
		},
		onAscending: function onAscending() {
			var oTable = this.getView().byId("accountSalesTable");
			var oItems = oTable.getBinding("items");
			var oBindingPath = this.getView().getModel().getProperty("/bindingValue");
			var oSorter = new Sorter(oBindingPath);
			oItems.sort(oSorter);
			this._oResponsivePopover.close();
		},
		onDescending: function onDescending() {
			var oTable = this.getView().byId("accountSalesTable");
			var oItems = oTable.getBinding("items");
			var oBindingPath = this.getView().getModel().getProperty("/bindingValue");
			var oSorter = new Sorter(oBindingPath, true);
			oItems.sort(oSorter);
			this._oResponsivePopover.close();
		},
		onOpen: function onOpen(oEvent) {
			//On Popover open focus on Input control
			var oPopover = sap.ui.getCore().byId(oEvent.getParameter("id"));
			var oPopoverContent = oPopover.getContent()[0];
			var oCustomListItem = oPopoverContent.getItems()[2];
			var oCustomContent = oCustomListItem.getContent()[0];
			var oInput = oCustomContent.getItems()[1];
			oInput.focus();
			oInput.$().find('.sapMInputBaseInner')[0].select();
		},
		_loadInfoData: function _loadInfoData(callback) {
			var that = this;
			var view = this.getView();
			var accountModel = view.getModel("accounts");
			var viewModel = view.getModel();
			viewModel.attachRequestSent(function () {
				var oTable = view.byId("accountSalesTable");
				oTable.setBusy(true);
				console.log("attachRequestSent");
			});
			viewModel.attachRequestCompleted(function () {
				var oTable = view.byId("accountSalesTable");
				oTable.setBusy(false);
				console.log("attachRequestCompleted");
			});
			accountModel.attachRequestCompleted(function () {
				var accounts = accountModel.getData();
				that.actualIban = accounts[0].iban;
				that.loadData();
				callback();
			});
			view.getModel("accounts").loadData("/apiFinTs/getAccounts");
		},
		loadData: function loadData() {
			var view = this.getView();
			var viewModel = view.getModel();
			//this.getView().getModel().loadData( "/apiFinTs/getAccountSales/" + this.actualIban + "/" + new Date( "2018-01-01T12:00:00Z" ) + "/" + new Date( "2019-05-20T12:00:00Z" ) );
			viewModel.loadData("/apiFinTs/getAccountSales/" + this.actualIban + "/" + this.startDate + "/" + this.endDate);
		},
		selectAccount: function selectAccount(oEvent) {

			var oItem = oEvent.getSource();
			var iban = oItem.getProperty("key");
			this.actualIban = iban;
			console.log(oItem.getProperty("key"));

			this.getView().getModel("dateSelect").setProperty("/dateValueDRS2", new Date(moment().subtract(6, 'month').startOf('month')));
			this.getView().getModel("dateSelect").setProperty("/secondDateValueDRS2", new Date());
			this.getView().getModel().loadData("/apiFinTs/getAccountSales/" + iban + "/" + new Date(moment().subtract(6, 'month').startOf('month')) + "/" + new Date());
		},
		filterTableViewAll: function filterTableViewAll() {
			var oTable = this.getView().byId("accountSalesTable");
			oTable.getBinding("items").filter([]);
		},
		filterTableViewIn: function filterTableViewIn() {
			var aFilters = [];
			aFilters.push(new Filter("isCredit", sap.ui.model.FilterOperator.EQ, true));
			aFilters.push(new Filter("isExpense", sap.ui.model.FilterOperator.EQ, true));

			var oTable = this.getView().byId("accountSalesTable");
			oTable.getBinding("items").filter([new Filter(aFilters, true)]);
		},
		filterTableViewOut: function filterTableViewOut() {
			var aFilters = [];
			aFilters.push(new Filter("isCredit", sap.ui.model.FilterOperator.EQ, false));
			aFilters.push(new Filter("isExpense", sap.ui.model.FilterOperator.EQ, true));

			var oTable = this.getView().byId("accountSalesTable");
			oTable.getBinding("items").filter([new Filter(aFilters, true)]);
		}
	});
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRyb2xsZXIvYWNjb3VudFNhbGVzL0FjY291bnRTYWxlcy5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbIl9vUmVzcG9uc2l2ZVBvcG92ZXIiLCJzdGFydERhdGUiLCJEYXRlIiwibW9tZW50Iiwic3VidHJhY3QiLCJzdGFydE9mIiwiZW5kRGF0ZSIsImFjdHVhbEliYW4iLCJmb3JtYXR0ZXIiLCJGb3JtYXR0ZXIiLCJvbkluaXQiLCJvUm91dGVyIiwic2FwIiwidWkiLCJjb3JlIiwiVUlDb21wb25lbnQiLCJnZXRSb3V0ZXJGb3IiLCJnZXRSb3V0ZSIsImF0dGFjaFBhdHRlcm5NYXRjaGVkIiwiX29uT2JqZWN0TWF0Y2hlZCIsIm9KU09OTW9kZWwiLCJKU09OTW9kZWwiLCJnZXRWaWV3Iiwic2V0TW9kZWwiLCJvSlNPTk1vZGVsQWNjb3VudHMiLCJkYXRlRnJvbSIsInNldFVUQ0RhdGUiLCJzZXRVVENNb250aCIsInNldFVUQ0Z1bGxZZWFyIiwiZGF0ZVRvIiwib01vZGVsIiwic2V0RGF0YSIsImRlbGltaXRlckRSUzEiLCJkYXRlVmFsdWVEUlMxIiwic2Vjb25kRGF0ZVZhbHVlRFJTMSIsImRhdGVGb3JtYXREUlMxIiwiZGF0ZVZhbHVlRFJTMiIsInNlY29uZERhdGVWYWx1ZURSUzIiLCJkYXRlTWluRFJTMiIsImRhdGVNYXhEUlMyIiwicmFuZ2VzIiwiZW5kT2YiLCJfaUV2ZW50IiwiX2xvYWRJbmZvRGF0YSIsInRoYXQiLCJ4bWxmcmFnbWVudCIsImdldE1vZGVsIiwib1RhYmxlIiwiYnlJZCIsIm9JdGVtcyIsImdldEJpbmRpbmciLCJvU29ydGVyIiwiU29ydGVyIiwic29ydCIsImFkZEV2ZW50RGVsZWdhdGUiLCJvbkFmdGVyUmVuZGVyaW5nIiwiY29uc29sZSIsImxvZyIsIm9IZWFkZXIiLCIkIiwic0lkIiwiZmluZCIsImkiLCJsZW5ndGgiLCJvSUQiLCJpZCIsIm9uQ2xpY2tTb3J0Iiwib0V2ZW50IiwiZ2V0UGFyYW1ldGVyIiwiaWJhbiIsImhhbmRsZURhdGVTZWxlY3RDaGFuZ2UiLCJzRnJvbSIsInNUbyIsImJWYWxpZCIsInNldFByb3BlcnR5IiwibG9hZERhdGEiLCJjbGljayIsImIiLCJvVGFyZ2V0IiwiY3VycmVudFRhcmdldCIsImRhdGEiLCJvTGFiZWxUZXh0IiwiY2hpbGROb2RlcyIsInRleHRDb250ZW50Iiwib0luZGV4Iiwic2xpY2UiLCJvVmlldyIsImdldFByb3BlcnR5Iiwib0tleXMiLCJPYmplY3QiLCJrZXlzIiwib3BlbkJ5Iiwib25DaGFuZ2UiLCJvVmFsdWUiLCJvTXVsdGlwbGVWYWx1ZXMiLCJzcGxpdCIsIm9CaW5kaW5nUGF0aCIsImFGaWx0ZXJzIiwib0ZpbHRlciIsIkZpbHRlciIsInB1c2giLCJmaWx0ZXIiLCJjbG9zZSIsIm9uQXNjZW5kaW5nIiwib25EZXNjZW5kaW5nIiwib25PcGVuIiwib1BvcG92ZXIiLCJnZXRDb3JlIiwib1BvcG92ZXJDb250ZW50IiwiZ2V0Q29udGVudCIsIm9DdXN0b21MaXN0SXRlbSIsImdldEl0ZW1zIiwib0N1c3RvbUNvbnRlbnQiLCJvSW5wdXQiLCJmb2N1cyIsInNlbGVjdCIsImNhbGxiYWNrIiwidmlldyIsImFjY291bnRNb2RlbCIsInZpZXdNb2RlbCIsImF0dGFjaFJlcXVlc3RTZW50Iiwic2V0QnVzeSIsImF0dGFjaFJlcXVlc3RDb21wbGV0ZWQiLCJhY2NvdW50cyIsImdldERhdGEiLCJzZWxlY3RBY2NvdW50Iiwib0l0ZW0iLCJnZXRTb3VyY2UiLCJmaWx0ZXJUYWJsZVZpZXdBbGwiLCJmaWx0ZXJUYWJsZVZpZXdJbiIsIm1vZGVsIiwiRmlsdGVyT3BlcmF0b3IiLCJFUSIsImZpbHRlclRhYmxlVmlld091dCJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBUUNBLHFCLEVBQXNCLEk7QUFFdEJDLFcsRUFBWSxJQUFJQyxJQUFKLENBQVNDLFNBQVNDLFFBQVQsQ0FBbUIsQ0FBbkIsRUFBc0IsT0FBdEIsRUFBZ0NDLE9BQWhDLENBQXlDLE9BQXpDLENBQVQsQztBQUNaQyxTLEVB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b2xsZXIuanMiLCJzb3VyY2VSb290IjoiLi9zcmMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgSlNPTk1vZGVsIGZyb20gXCJzYXAvdWkvbW9kZWwvanNvbi9KU09OTW9kZWxcIjtcbmltcG9ydCBGaWx0ZXIgZnJvbSBcInNhcC91aS9tb2RlbC9GaWx0ZXJcIjtcbmltcG9ydCBTb3J0ZXIgZnJvbSBcInNhcC91aS9tb2RlbC9Tb3J0ZXJcIlxuaW1wb3J0IEZvcm1hdHRlciBmcm9tIFwiY29tL3VuaW9yZy9jZi9iYW5raW5nL2V4YW1wbGUvdXRpbHMvRm9ybWF0dGVyXCJcbmltcG9ydCBCYXNlQ29udHJvbGxlciBmcm9tIFwiY29tL3VuaW9yZy9jZi9iYW5raW5nL2V4YW1wbGUvY29udHJvbGxlci9CYXNlQ29udHJvbGxlclwiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBY2NvdW50U2FsZXMgZXh0ZW5kcyBCYXNlQ29udHJvbGxlciB7XG5cblx0X29SZXNwb25zaXZlUG9wb3ZlciA9IG51bGxcblxuXHRzdGFydERhdGUgPSBuZXcgRGF0ZShtb21lbnQoKS5zdWJ0cmFjdCggNSwgJ21vbnRoJyApLnN0YXJ0T2YoICdtb250aCcgKSlcblx0ZW5kRGF0ZSA9IG5ldyBEYXRlKClcblx0YWN0dWFsSWJhbiA9IG51bGxcblx0Zm9ybWF0dGVyID0gRm9ybWF0dGVyXG5cblx0b25Jbml0KCkge1xuXHRcdHZhciBvUm91dGVyID0gc2FwLnVpLmNvcmUuVUlDb21wb25lbnQuZ2V0Um91dGVyRm9yKHRoaXMpO1xuXHRcdG9Sb3V0ZXIuZ2V0Um91dGUoXCJhY2NvdW50U2FsZXNJYmFuXCIpLmF0dGFjaFBhdHRlcm5NYXRjaGVkKHRoaXMuX29uT2JqZWN0TWF0Y2hlZCwgdGhpcyk7XG5cblx0XHR2YXIgb0pTT05Nb2RlbCA9IG5ldyBKU09OTW9kZWwoKTtcblx0XHR0aGlzLmdldFZpZXcoKS5zZXRNb2RlbCggb0pTT05Nb2RlbCApO1xuXHRcdHZhciBvSlNPTk1vZGVsQWNjb3VudHMgPSBuZXcgSlNPTk1vZGVsKCk7XG5cdFx0dGhpcy5nZXRWaWV3KCkuc2V0TW9kZWwoIG9KU09OTW9kZWxBY2NvdW50cywgXCJhY2NvdW50c1wiICk7XG5cblx0XHR2YXIgZGF0ZUZyb20gPSBuZXcgRGF0ZSgpO1xuXHRcdGRhdGVGcm9tLnNldFVUQ0RhdGUoMik7XG5cdFx0ZGF0ZUZyb20uc2V0VVRDTW9udGgoMSk7XG5cdFx0ZGF0ZUZyb20uc2V0VVRDRnVsbFllYXIoMjAxNCk7XG5cblx0XHR2YXIgZGF0ZVRvID0gbmV3IERhdGUoKTtcblx0XHRkYXRlVG8uc2V0VVRDRGF0ZSgxNyk7XG5cdFx0ZGF0ZVRvLnNldFVUQ01vbnRoKDEpO1xuXHRcdGRhdGVUby5zZXRVVENGdWxsWWVhcigyMDE0KTtcblxuXG5cdFx0dmFyIG9Nb2RlbCA9IG5ldyBKU09OTW9kZWwoKTtcblx0XHRvTW9kZWwuc2V0RGF0YSgge1xuXHRcdFx0XHRcdFx0XHRkZWxpbWl0ZXJEUlMxOiBcIkBcIixcblx0XHRcdFx0XHRcdFx0ZGF0ZVZhbHVlRFJTMTogZGF0ZUZyb20sXG5cdFx0XHRcdFx0XHRcdHNlY29uZERhdGVWYWx1ZURSUzE6IGRhdGVUbyxcblx0XHRcdFx0XHRcdFx0ZGF0ZUZvcm1hdERSUzE6IFwieXl5eS9NTS9kZFwiLFxuXHRcdFx0XHRcdFx0XHRkYXRlVmFsdWVEUlMyOm5ldyBEYXRlKG1vbWVudCgpLnN1YnRyYWN0KCA2LCAnbW9udGgnICkuc3RhcnRPZiggJ21vbnRoJyApKSxcblx0XHRcdFx0XHRcdFx0c2Vjb25kRGF0ZVZhbHVlRFJTMjogbmV3IERhdGUoKSxcblx0XHRcdFx0XHRcdFx0ZGF0ZU1pbkRSUzI6IG5ldyBEYXRlKG1vbWVudCgpLnN1YnRyYWN0KCA2LCAnbW9udGgnICkuc3RhcnRPZiggJ21vbnRoJyApKSxcblx0XHRcdFx0XHRcdFx0ZGF0ZU1heERSUzI6IG5ldyBEYXRlKCksXG5cdFx0XHRcdFx0XHRcdHJhbmdlczoge1xuXHRcdFx0XHRcdFx0XHRcdCdUb2RheSc6IFttb21lbnQoKSwgbW9tZW50KCldLFxuXHRcdFx0XHRcdFx0XHRcdCdZZXN0ZXJkYXknOiBbbW9tZW50KCkuc3VidHJhY3QoIDEsICdkYXlzJyApLCBtb21lbnQoKS5zdWJ0cmFjdCggMSwgJ2RheXMnICldLFxuXHRcdFx0XHRcdFx0XHRcdCdMYXN0IDcgRGF5cyc6IFttb21lbnQoKS5zdWJ0cmFjdCggNiwgJ2RheXMnICksIG1vbWVudCgpXSxcblx0XHRcdFx0XHRcdFx0XHQnTGFzdCAzMCBEYXlzJzogW21vbWVudCgpLnN1YnRyYWN0KCAyOSwgJ2RheXMnICksIG1vbWVudCgpXSxcblx0XHRcdFx0XHRcdFx0XHQnVGhpcyBNb250aCc6IFttb21lbnQoKS5zdGFydE9mKCAnbW9udGgnICksIG1vbWVudCgpLmVuZE9mKCAnbW9udGgnICldLFxuXHRcdFx0XHRcdFx0XHRcdCdMYXN0IE1vbnRoJzogW21vbWVudCgpLnN1YnRyYWN0KCAxLCAnbW9udGgnICkuc3RhcnRPZiggJ21vbnRoJyApLCBtb21lbnQoKS5zdWJ0cmFjdCggMSwgJ21vbnRoJyApLmVuZE9mKCAnbW9udGgnICldXG5cdFx0XHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0XHR9ICk7XG5cdFx0dGhpcy5nZXRWaWV3KCkuc2V0TW9kZWwoIG9Nb2RlbCwgXCJkYXRlU2VsZWN0XCIgKTtcblx0XHR0aGlzLl9pRXZlbnQgPSAwO1xuXHRcdHRoaXMuX2xvYWRJbmZvRGF0YSggKCkgPT4ge1xuXG5cdFx0fSApO1xuXHRcdHZhciB0aGF0ID0gdGhpcztcblx0XHRpZiAoICF0aGlzLl9vUmVzcG9uc2l2ZVBvcG92ZXIgKSB7XG5cdFx0XHR0aGlzLl9vUmVzcG9uc2l2ZVBvcG92ZXIgPSBzYXAudWkueG1sZnJhZ21lbnQoIFwiY29tLnVuaW9yZy5jZi5iYW5raW5nLmV4YW1wbGUuZnJhZ21lbnRzLlNvcnRQb3BvdmVyXCIsIHRoaXMgKTtcblx0XHRcdHRoaXMuX29SZXNwb25zaXZlUG9wb3Zlci5zZXRNb2RlbCggdGhpcy5nZXRWaWV3KCkuZ2V0TW9kZWwoKSApO1xuXHRcdH1cblx0XHR2YXIgb1RhYmxlID0gdGhpcy5nZXRWaWV3KCkuYnlJZCggXCJhY2NvdW50U2FsZXNUYWJsZVwiICk7XG5cdFx0dmFyIG9JdGVtcyA9IG9UYWJsZS5nZXRCaW5kaW5nKCBcIml0ZW1zXCIgKTtcblx0XHR2YXIgb1NvcnRlciA9IG5ldyBTb3J0ZXIoIFwidmFsdWVEYXRlXCIsIHRydWUgKTtcblx0XHRvSXRlbXMuc29ydCggb1NvcnRlciApO1xuXHRcdG9UYWJsZS5hZGRFdmVudERlbGVnYXRlKCB7XG5cdFx0XHRcdFx0XHRcdFx0XHQgb25BZnRlclJlbmRlcmluZzogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCBjb25zb2xlLmxvZyggdGhpcyApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQgdmFyIG9IZWFkZXIgPSAkKCBcIiNcIiArIHRoaXMuc0lkICkuZmluZCggJy5zYXBNTGlzdFRibEhlYWRlckNlbGwnICk7IC8vR2V0IGhvbGQgb2YgdGFibGUgaGVhZGVyIGVsZW1lbnRzXG5cdFx0XHRcdFx0XHRcdFx0XHRcdCBjb25zb2xlLmxvZyggb0hlYWRlciApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQgZm9yICggdmFyIGkgPSAwOyBpIDwgb0hlYWRlci5sZW5ndGg7IGkrKyApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHQgdmFyIG9JRCA9IG9IZWFkZXJbaV0uaWQ7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0IHRoYXQub25DbGlja1NvcnQoIG9JRCApO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQgfVxuXHRcdFx0XHRcdFx0XHRcdFx0IH1cblx0XHRcdFx0XHRcdFx0XHQgfSwgb1RhYmxlICk7XG5cdH1cblxuXHRfb25PYmplY3RNYXRjaGVkIChvRXZlbnQpIHtcblx0XHRjb25zb2xlLmxvZyhvRXZlbnQuZ2V0UGFyYW1ldGVyKFwiYXJndW1lbnRzXCIpLmliYW4pXG5cdH1cblxuXHRoYW5kbGVEYXRlU2VsZWN0Q2hhbmdlKCBvRXZlbnQgKSB7XG5cdFx0bGV0IHNGcm9tID0gb0V2ZW50LmdldFBhcmFtZXRlciggXCJmcm9tXCIgKTtcblx0XHRsZXQgc1RvID0gb0V2ZW50LmdldFBhcmFtZXRlciggXCJ0b1wiICk7XG5cdFx0bGV0IGJWYWxpZCA9IG9FdmVudC5nZXRQYXJhbWV0ZXIoIFwidmFsaWRcIiApO1xuXHRcdHRoaXMuX2lFdmVudCsrO1xuXG5cdFx0aWYgKGJWYWxpZCkge1xuXHRcdFx0dGhpcy5zdGFydERhdGUgPSBuZXcgRGF0ZShzRnJvbSlcblx0XHRcdHRoaXMuZW5kRGF0ZSA9IG5ldyBEYXRlKHNUbylcblx0XHRcdHRoaXMuZ2V0VmlldygpLmdldE1vZGVsKFwiZGF0ZVNlbGVjdFwiICkuc2V0UHJvcGVydHkoXCIvZGF0ZVZhbHVlRFJTMlwiLCBuZXcgRGF0ZShzRnJvbSkpXG5cdFx0XHR0aGlzLmdldFZpZXcoKS5nZXRNb2RlbChcImRhdGVTZWxlY3RcIiApLnNldFByb3BlcnR5KFwiL3NlY29uZERhdGVWYWx1ZURSUzJcIiwgbmV3IERhdGUoc1RvKSApXG5cdFx0XHR0aGlzLmxvYWREYXRhKClcblx0XHR9XG5cdH1cblxuXHRvbkNsaWNrU29ydCggb0lEICkge1xuXHRcdHZhciB0aGF0ID0gdGhpcztcblx0XHQkKCAnIycgKyBvSUQgKS5jbGljayggZnVuY3Rpb24oIG9FdmVudCwgYiApIHsgLy9BdHRhY2ggVGFibGUgSGVhZGVyIEVsZW1lbnQgRXZlbnRcblx0XHRcdHZhciBvVGFyZ2V0ID0gb0V2ZW50LmN1cnJlbnRUYXJnZXQ7IC8vR2V0IGhvbGQgb2YgSGVhZGVyIEVsZW1lbnRcblx0XHRcdGxldCBzb3J0ID0gJCggb1RhcmdldCApLmRhdGEoIFwic29ydFwiIClcblx0XHRcdGNvbnNvbGUubG9nKCBzb3J0ICk7XG5cdFx0XHR2YXIgb0xhYmVsVGV4dCA9IG9UYXJnZXQuY2hpbGROb2Rlc1swXS50ZXh0Q29udGVudDsgLy9HZXQgQ29sdW1uIEhlYWRlciB0ZXh0XG5cdFx0XHR2YXIgb0luZGV4ID0gb1RhcmdldC5pZC5zbGljZSggLTEgKTsgLy9HZXQgdGhlIGNvbHVtbiBJbmRleFxuXHRcdFx0dmFyIG9WaWV3ID0gdGhhdC5nZXRWaWV3KCk7XG5cdFx0XHR2YXIgb1RhYmxlID0gb1ZpZXcuYnlJZCggXCJhY2NvdW50U2FsZXNUYWJsZVwiICk7XG5cdFx0XHR2YXIgb01vZGVsID0gb1RhYmxlLmdldE1vZGVsKCkuZ2V0UHJvcGVydHkoIFwiL3RyYW5zYWN0aW9uc1wiICk7IC8vR2V0IEhvbGQgb2YgVGFibGUgTW9kZWwgVmFsdWVzXG5cblx0XHRcdHZhciBvS2V5cyA9IE9iamVjdC5rZXlzKCBvTW9kZWxbMF0gKTsgLy9HZXQgSG9sZCBvZiBNb2RlbCBLZXlzIHRvIGZpbHRlciB0aGUgdmFsdWVcblxuXHRcdFx0b1ZpZXcuZ2V0TW9kZWwoKS5zZXRQcm9wZXJ0eSggXCIvYmluZGluZ1ZhbHVlXCIsIHNvcnQgKTsgLy9TYXZlIHRoZSBrZXkgdmFsdWUgdG8gcHJvcGVydHlcblx0XHRcdHRoYXQuX29SZXNwb25zaXZlUG9wb3Zlci5vcGVuQnkoIG9UYXJnZXQgKTtcblx0XHR9ICk7XG5cdH1cblxuXHRvbkNoYW5nZSggb0V2ZW50ICkge1xuXHRcdHZhciBvVmFsdWUgPSBvRXZlbnQuZ2V0UGFyYW1ldGVyKCBcInZhbHVlXCIgKTtcblx0XHR2YXIgb011bHRpcGxlVmFsdWVzID0gb1ZhbHVlLnNwbGl0KCBcIixcIiApO1xuXHRcdHZhciBvVGFibGUgPSB0aGlzLmdldFZpZXcoKS5ieUlkKCBcImFjY291bnRTYWxlc1RhYmxlXCIgKTtcblx0XHR2YXIgb0JpbmRpbmdQYXRoID0gdGhpcy5nZXRWaWV3KCkuZ2V0TW9kZWwoKS5nZXRQcm9wZXJ0eSggXCIvYmluZGluZ1ZhbHVlXCIgKTsgLy9HZXQgSG9sZCBvZiBNb2RlbCBLZXkgdmFsdWUgdGhhdCB3YXMgc2F2ZWRcblx0XHR2YXIgYUZpbHRlcnMgPSBbXTtcblx0XHRjb25zb2xlLmxvZyggb0JpbmRpbmdQYXRoICk7XG5cdFx0Zm9yICggdmFyIGkgPSAwOyBpIDwgb011bHRpcGxlVmFsdWVzLmxlbmd0aDsgaSsrICkge1xuXHRcdFx0dmFyIG9GaWx0ZXIgPSBuZXcgRmlsdGVyKCBvQmluZGluZ1BhdGgsIFwiQ29udGFpbnNcIiwgb011bHRpcGxlVmFsdWVzW2ldICk7XG5cdFx0XHRhRmlsdGVycy5wdXNoKCBvRmlsdGVyIClcblx0XHR9XG5cdFx0dmFyIG9JdGVtcyA9IG9UYWJsZS5nZXRCaW5kaW5nKCBcIml0ZW1zXCIgKTtcblx0XHRvSXRlbXMuZmlsdGVyKCBhRmlsdGVycywgXCJBcHBsaWNhdGlvblwiICk7XG5cdFx0dGhpcy5fb1Jlc3BvbnNpdmVQb3BvdmVyLmNsb3NlKCk7XG5cdH1cblxuXHRvbkFzY2VuZGluZygpIHtcblx0XHR2YXIgb1RhYmxlID0gdGhpcy5nZXRWaWV3KCkuYnlJZCggXCJhY2NvdW50U2FsZXNUYWJsZVwiICk7XG5cdFx0dmFyIG9JdGVtcyA9IG9UYWJsZS5nZXRCaW5kaW5nKCBcIml0ZW1zXCIgKTtcblx0XHR2YXIgb0JpbmRpbmdQYXRoID0gdGhpcy5nZXRWaWV3KCkuZ2V0TW9kZWwoKS5nZXRQcm9wZXJ0eSggXCIvYmluZGluZ1ZhbHVlXCIgKTtcblx0XHR2YXIgb1NvcnRlciA9IG5ldyBTb3J0ZXIoIG9CaW5kaW5nUGF0aCApO1xuXHRcdG9JdGVtcy5zb3J0KCBvU29ydGVyICk7XG5cdFx0dGhpcy5fb1Jlc3BvbnNpdmVQb3BvdmVyLmNsb3NlKCk7XG5cdH1cblxuXHRvbkRlc2NlbmRpbmcoKSB7XG5cdFx0dmFyIG9UYWJsZSA9IHRoaXMuZ2V0VmlldygpLmJ5SWQoIFwiYWNjb3VudFNhbGVzVGFibGVcIiApO1xuXHRcdHZhciBvSXRlbXMgPSBvVGFibGUuZ2V0QmluZGluZyggXCJpdGVtc1wiICk7XG5cdFx0dmFyIG9CaW5kaW5nUGF0aCA9IHRoaXMuZ2V0VmlldygpLmdldE1vZGVsKCkuZ2V0UHJvcGVydHkoIFwiL2JpbmRpbmdWYWx1ZVwiICk7XG5cdFx0dmFyIG9Tb3J0ZXIgPSBuZXcgU29ydGVyKCBvQmluZGluZ1BhdGgsIHRydWUgKTtcblx0XHRvSXRlbXMuc29ydCggb1NvcnRlciApO1xuXHRcdHRoaXMuX29SZXNwb25zaXZlUG9wb3Zlci5jbG9zZSgpO1xuXHR9XG5cblx0b25PcGVuKCBvRXZlbnQgKSB7XG5cdFx0Ly9PbiBQb3BvdmVyIG9wZW4gZm9jdXMgb24gSW5wdXQgY29udHJvbFxuXHRcdHZhciBvUG9wb3ZlciA9IHNhcC51aS5nZXRDb3JlKCkuYnlJZCggb0V2ZW50LmdldFBhcmFtZXRlciggXCJpZFwiICkgKTtcblx0XHR2YXIgb1BvcG92ZXJDb250ZW50ID0gb1BvcG92ZXIuZ2V0Q29udGVudCgpWzBdO1xuXHRcdHZhciBvQ3VzdG9tTGlzdEl0ZW0gPSBvUG9wb3ZlckNvbnRlbnQuZ2V0SXRlbXMoKVsyXTtcblx0XHR2YXIgb0N1c3RvbUNvbnRlbnQgPSBvQ3VzdG9tTGlzdEl0ZW0uZ2V0Q29udGVudCgpWzBdO1xuXHRcdHZhciBvSW5wdXQgPSBvQ3VzdG9tQ29udGVudC5nZXRJdGVtcygpWzFdO1xuXHRcdG9JbnB1dC5mb2N1cygpO1xuXHRcdG9JbnB1dC4kKCkuZmluZCggJy5zYXBNSW5wdXRCYXNlSW5uZXInIClbMF0uc2VsZWN0KCk7XG5cdH1cblxuXHRfbG9hZEluZm9EYXRhKCBjYWxsYmFjayApIHtcblx0XHRsZXQgdGhhdCA9IHRoaXNcblx0XHRsZXQgdmlldyA9IHRoaXMuZ2V0VmlldygpO1xuXHRcdGxldCBhY2NvdW50TW9kZWwgPSB2aWV3LmdldE1vZGVsKCBcImFjY291bnRzXCIgKVxuXHRcdGxldCB2aWV3TW9kZWwgPSB2aWV3LmdldE1vZGVsKClcblx0XHR2aWV3TW9kZWwuYXR0YWNoUmVxdWVzdFNlbnQoIGZ1bmN0aW9uKCkge1xuXHRcdFx0bGV0IG9UYWJsZSA9IHZpZXcuYnlJZCggXCJhY2NvdW50U2FsZXNUYWJsZVwiIClcblx0XHRcdG9UYWJsZS5zZXRCdXN5KCB0cnVlIClcblx0XHRcdGNvbnNvbGUubG9nKCBcImF0dGFjaFJlcXVlc3RTZW50XCIgKTtcblx0XHR9IClcblx0XHR2aWV3TW9kZWwuYXR0YWNoUmVxdWVzdENvbXBsZXRlZCggZnVuY3Rpb24oKSB7XG5cdFx0XHRsZXQgb1RhYmxlID0gdmlldy5ieUlkKCBcImFjY291bnRTYWxlc1RhYmxlXCIgKVxuXHRcdFx0b1RhYmxlLnNldEJ1c3koIGZhbHNlIClcblx0XHRcdGNvbnNvbGUubG9nKCBcImF0dGFjaFJlcXVlc3RDb21wbGV0ZWRcIiApO1xuXHRcdH0gKVxuXHRcdGFjY291bnRNb2RlbC5hdHRhY2hSZXF1ZXN0Q29tcGxldGVkKCBmdW5jdGlvbigpIHtcblx0XHRcdGxldCBhY2NvdW50cyA9IGFjY291bnRNb2RlbC5nZXREYXRhKCk7XG5cdFx0XHR0aGF0LmFjdHVhbEliYW4gPSBhY2NvdW50c1swXS5pYmFuXG5cdFx0XHR0aGF0LmxvYWREYXRhKClcblx0XHRcdGNhbGxiYWNrKCk7XG5cdFx0fSApO1xuXHRcdHZpZXcuZ2V0TW9kZWwoIFwiYWNjb3VudHNcIiApLmxvYWREYXRhKCBcIi9hcGlGaW5Ucy9nZXRBY2NvdW50c1wiICk7XG5cdH1cblxuXHRsb2FkRGF0YSgpIHtcblx0XHRsZXQgdmlldyA9IHRoaXMuZ2V0VmlldygpO1xuXHRcdGxldCB2aWV3TW9kZWwgPSB2aWV3LmdldE1vZGVsKClcblx0XHQvL3RoaXMuZ2V0VmlldygpLmdldE1vZGVsKCkubG9hZERhdGEoIFwiL2FwaUZpblRzL2dldEFjY291bnRTYWxlcy9cIiArIHRoaXMuYWN0dWFsSWJhbiArIFwiL1wiICsgbmV3IERhdGUoIFwiMjAxOC0wMS0wMVQxMjowMDowMFpcIiApICsgXCIvXCIgKyBuZXcgRGF0ZSggXCIyMDE5LTA1LTIwVDEyOjAwOjAwWlwiICkgKTtcblx0XHR2aWV3TW9kZWwubG9hZERhdGEoIFwiL2FwaUZpblRzL2dldEFjY291bnRTYWxlcy9cIiArIHRoaXMuYWN0dWFsSWJhbiArIFwiL1wiICsgdGhpcy5zdGFydERhdGUgKyBcIi9cIiArIHRoaXMuZW5kRGF0ZSApO1xuXHR9XG5cblx0c2VsZWN0QWNjb3VudCggb0V2ZW50ICkge1xuXG5cdFx0dmFyIG9JdGVtID0gb0V2ZW50LmdldFNvdXJjZSgpO1xuXHRcdGxldCBpYmFuID0gb0l0ZW0uZ2V0UHJvcGVydHkoIFwia2V5XCIgKTtcblx0XHR0aGlzLmFjdHVhbEliYW4gPSBpYmFuXG5cdFx0Y29uc29sZS5sb2coIG9JdGVtLmdldFByb3BlcnR5KCBcImtleVwiICkgKVxuXG5cdFx0dGhpcy5nZXRWaWV3KCkuZ2V0TW9kZWwoXCJkYXRlU2VsZWN0XCIgKS5zZXRQcm9wZXJ0eShcIi9kYXRlVmFsdWVEUlMyXCIsIG5ldyBEYXRlKG1vbWVudCgpLnN1YnRyYWN0KCA2LCAnbW9udGgnICkuc3RhcnRPZiggJ21vbnRoJyApKSk7XG5cdFx0dGhpcy5nZXRWaWV3KCkuZ2V0TW9kZWwoXCJkYXRlU2VsZWN0XCIgKS5zZXRQcm9wZXJ0eShcIi9zZWNvbmREYXRlVmFsdWVEUlMyXCIsIG5ldyBEYXRlKCkgKTtcblx0XHR0aGlzLmdldFZpZXcoKS5nZXRNb2RlbCgpLmxvYWREYXRhKCBcIi9hcGlGaW5Ucy9nZXRBY2NvdW50U2FsZXMvXCIgKyBpYmFuICsgXCIvXCIgKyBuZXcgRGF0ZShtb21lbnQoKS5zdWJ0cmFjdCggNiwgJ21vbnRoJyApLnN0YXJ0T2YoICdtb250aCcgKSkgKyBcIi9cIiArIG5ldyBEYXRlKCkgKTtcblx0fVxuXG5cdGZpbHRlclRhYmxlVmlld0FsbCgpIHtcblx0XHRsZXQgb1RhYmxlID0gdGhpcy5nZXRWaWV3KCkuYnlJZCggXCJhY2NvdW50U2FsZXNUYWJsZVwiIClcblx0XHRvVGFibGUuZ2V0QmluZGluZyggXCJpdGVtc1wiICkuZmlsdGVyKCBbXSApO1xuXHR9XG5cblx0ZmlsdGVyVGFibGVWaWV3SW4oKSB7XG5cdFx0bGV0IGFGaWx0ZXJzID0gW107XG5cdFx0YUZpbHRlcnMucHVzaCggbmV3IEZpbHRlciggXCJpc0NyZWRpdFwiLCBzYXAudWkubW9kZWwuRmlsdGVyT3BlcmF0b3IuRVEsIHRydWUgKSApO1xuXHRcdGFGaWx0ZXJzLnB1c2goIG5ldyBGaWx0ZXIoIFwiaXNFeHBlbnNlXCIsIHNhcC51aS5tb2RlbC5GaWx0ZXJPcGVyYXRvci5FUSwgdHJ1ZSApICk7XG5cblx0XHRsZXQgb1RhYmxlID0gdGhpcy5nZXRWaWV3KCkuYnlJZCggXCJhY2NvdW50U2FsZXNUYWJsZVwiIClcblx0XHRvVGFibGUuZ2V0QmluZGluZyggXCJpdGVtc1wiICkuZmlsdGVyKCBbbmV3IEZpbHRlciggYUZpbHRlcnMsIHRydWUgKV0gKTtcblx0fVxuXG5cdGZpbHRlclRhYmxlVmlld091dCgpIHtcblx0XHRsZXQgYUZpbHRlcnMgPSBbXTtcblx0XHRhRmlsdGVycy5wdXNoKCBuZXcgRmlsdGVyKCBcImlzQ3JlZGl0XCIsIHNhcC51aS5tb2RlbC5GaWx0ZXJPcGVyYXRvci5FUSwgZmFsc2UgKSApO1xuXHRcdGFGaWx0ZXJzLnB1c2goIG5ldyBGaWx0ZXIoIFwiaXNFeHBlbnNlXCIsIHNhcC51aS5tb2RlbC5GaWx0ZXJPcGVyYXRvci5FUSwgdHJ1ZSApICk7XG5cblx0XHRsZXQgb1RhYmxlID0gdGhpcy5nZXRWaWV3KCkuYnlJZCggXCJhY2NvdW50U2FsZXNUYWJsZVwiIClcblx0XHRvVGFibGUuZ2V0QmluZGluZyggXCJpdGVtc1wiICkuZmlsdGVyKCBbbmV3IEZpbHRlciggYUZpbHRlcnMsIHRydWUgKV0gKTtcblx0fVxufSJdfQ==