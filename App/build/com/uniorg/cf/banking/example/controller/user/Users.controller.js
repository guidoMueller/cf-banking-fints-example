"use strict";

sap.ui.define(["com/uniorg/cf/banking/example/controller/BaseController", "sap/ui/model/json/JSONModel", "sap/m/MessageToast"], function (BaseController, JSONModel, MessageToast) {
	"use strict";

	return BaseController.extend("com.uniorg.cf.banking.example.controller.user.Users", {
		onInit: function onInit() {
			var oJSONModel = new JSONModel();
			this.getView().setModel(oJSONModel);
			this._loadUserData();
		},

		onAddUser: function onAddUser(oEvent) {
			this._getDialog().open();
			this._loadUserData();
		},

		onDeleteUser: function onDeleteUser(oEvent) {
			var that = this;

			var oContext = oEvent.getSource().getParent().getBindingContext();

			var id = oContext.getProperty("id");

			$.ajax({
				url: "/api/user/" + id,
				type: "DELETE"
			}).done(function () {
				MessageToast.show(that.getResourceBundle().getText("msgUserDeleted", [id]));
				that._loadUserData();
			}).fail(function (jqXHR, textStatus, error) {
				MessageToast.show(that.getResourceBundle().getText("msgError"));
			});
		},

		onCloseAddUserDialog: function onCloseAddUserDialog() {
			this._getDialog().close();
			this._getDialog().destroy();
			delete this._oDialog;
		},

		onSaveAddUserDialog: function onSaveAddUserDialog() {
			var that = this;

			var id = sap.ui.getCore().byId("ipID").getValue();
			var userName = sap.ui.getCore().byId("ipUserName").getValue();
			var lastName = sap.ui.getCore().byId("ipLastName").getValue();
			var firstName = sap.ui.getCore().byId("ipFirstName").getValue();

			if (id === "" || userName === "" || lastName === "" || firstName === "") {
				MessageToast.show(that.getResourceBundle().getText("msgPleaseEnterAllValues"));
				return;
			}

			var userData = {
				"id": id,
				"user_name": userName,
				"last_name": lastName,
				"first_name": firstName
			};

			$.ajax({
				url: "/api/user/",
				type: "POST",
				contentType: "application/json",
				data: JSON.stringify(userData)
			}).done(function () {
				MessageToast.show(that.getResourceBundle().getText("msgUserAdded", [id]));
				that._loadUserData();
			}).fail(function (jqXHR, textStatus, error) {
				MessageToast.show(that.getResourceBundle().getText("msgError"));
			});

			this.onCloseAddUserDialog();
		},

		onRefreshUser: function onRefreshUser() {
			this._loadUserData();
		},

		_loadUserData: function _loadUserData() {
			this.getView().getModel().loadData("/api/user");
		},

		_getDialog: function _getDialog() {
			if (!this._oDialog) {
				this._oDialog = sap.ui.xmlfragment("com.uniorg.cf.banking.example.view.user.UserCreate", this);
				this.getView().addDependent(this._oDialog);
			}
			return this._oDialog;
		}

	});
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbnRyb2xsZXIvdXNlci9Vc2Vycy5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbInNhcCIsInVpIiwiZGVmaW5lIiwiQmFzZUNvbnRyb2xsZXIiLCJKU09OTW9kZWwiLCJNZXNzYWdlVG9hc3QiLCJleHRlbmQiLCJvbkluaXQiLCJvSlNPTk1vZGVsIiwiZ2V0VmlldyIsInNldE1vZGVsIiwiX2xvYWRVc2VyRGF0YSIsIm9uQWRkVXNlciIsIm9FdmVudCIsIl9nZXREaWFsb2ciLCJvcGVuIiwib25EZWxldGVVc2VyIiwidGhhdCIsIm9Db250ZXh0IiwiZ2V0U291cmNlIiwiZ2V0UGFyZW50IiwiZ2V0QmluZGluZ0NvbnRleHQiLCJpZCIsImdldFByb3BlcnR5IiwiJCIsImFqYXgiLCJ1cmwiLCJ0eXBlIiwiZG9uZSIsInNob3ciLCJnZXRSZXNvdXJjZUJ1bmRsZSIsImdldFRleHQiLCJmYWlsIiwianFYSFIiLCJ0ZXh0U3RhdHVzIiwiZXJyb3IiLCJvbkNsb3NlQWRkVXNlckRpYWxvZyIsImNsb3NlIiwiZGVzdHJveSIsIl9vRGlhbG9nIiwib25TYXZlQWRkVXNlckRpYWxvZyIsImdldENvcmUiLCJieUlkIiwiZ2V0VmFsdWUiLCJ1c2VyTmFtZSIsImxhc3ROYW1lIiwiZmlyc3ROYW1lIiwidXNlckRhdGEiLCJjb250ZW50VHlwZSIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5Iiwib25SZWZyZXNoVXNlciIsImdldE1vZGVsIiwibG9hZERhdGEiLCJ4bWxmcmFnbWVudCIsImFkZERlcGVuZGVudCJdLCJtYXBwaW5ncyI6Ijs7QUFBQUEsSUFBSUMsRUFBSixDQUFPQyxNQUFQLENBQWMsQ0FDYix5REFEYSxFQUViLDZCQUZhLEVBR2Isb0JBSGEsQ0FBZCxFQUlHLFVBQVNDLGNBQVQsRUFBeUJDLFNBQXpCLEVBQW9DQyxZQUFwQyxFQUFrRDtBQUNwRDs7QUFFQSxRQUFPRixlQUFlRyxNQUFmLENBQXNCLHFEQUF0QixFQUE2RTtBQUNuRkMsVUFBUSxrQkFBVTtB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aUJBQWF3QixJQUFiLENBQWtCWixLQUFLYSxpQkFBTCxHQUF5QkMsT0FBekIsQ0FBaUMsVUFBakMsQ0FBbEI7QUFDQSxJQVZEOztBQVlBLFFBQUtLLG9CQUFMO0FBQ0EsR0FyRWtGOztBQXVFbkZnQixpQkFBZSx5QkFBVTtBQUN4QixRQUFLekMsYUFBTDtBQUNBLEdBekVrRjs7QUEyRW5GQSxpQkFBZSx5QkFBVTtBQUN4QixRQUFLRixPQUFMLEdBQWU0QyxRQUFmLEdBQTBCQyxRQUExQixDQUFtQyxXQUFuQztBQUNBLEdBN0VrRjs7QUErRW5GeEMsY0FBYSxzQkFBWTtBQUNsQixPQUFJLENBQUMsS0FBS3lCLFFBQVYsRUFBb0I7QUFDaEIsU0FBS0EsUUFBTCxHQUFnQnZDLElBQUlDLEVBQUosQ0FBT3NELFdBQVAsQ0FBbUIsb0RBQW5CLEVBQXlFLElBQXpFLENBQWhCO0FBQ0EsU0FBSzlDLE9BQUwsR0FBZStDLFlBQWYsQ0FBNEIsS0FBS2pCLFFBQWpDO0FBQ0Y7QUFDRCxVQUFPLEtBQUtBLFFBQVo7QUFDRjs7QUFyRjZFLEVBQTdFLENBQVA7QUF3RkEsQ0EvRkQiLCJmaWxlIjoiY29udHJvbGxlci91c2VyL1VzZXJzLmNvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiLi9zcmMiLCJzb3VyY2VzQ29udGVudCI6WyJzYXAudWkuZGVmaW5lKFtcblx0XCJjb20vdW5pb3JnL2NmL2JhbmtpbmcvZXhhbXBsZS9jb250cm9sbGVyL0Jhc2VDb250cm9sbGVyXCIsXG5cdFwic2FwL3VpL21vZGVsL2pzb24vSlNPTk1vZGVsXCIsXG5cdFwic2FwL20vTWVzc2FnZVRvYXN0XCJcbl0sIGZ1bmN0aW9uKEJhc2VDb250cm9sbGVyLCBKU09OTW9kZWwsIE1lc3NhZ2VUb2FzdCkge1xuXHRcInVzZSBzdHJpY3RcIjtcblxuXHRyZXR1cm4gQmFzZUNvbnRyb2xsZXIuZXh0ZW5kKFwiY29tLnVuaW9yZy5jZi5iYW5raW5nLmV4YW1wbGUuY29udHJvbGxlci51c2VyLlVzZXJzXCIsIHtcblx0XHRvbkluaXQ6IGZ1bmN0aW9uKCl7XG5cdFx0XHR2YXIgb0pTT05Nb2RlbCA9IG5ldyBKU09OTW9kZWwoKTtcblx0XHRcdHRoaXMuZ2V0VmlldygpLnNldE1vZGVsKG9KU09OTW9kZWwpO1xuXHRcdFx0dGhpcy5fbG9hZFVzZXJEYXRhKCk7XG5cdFx0fSxcblxuXHRcdG9uQWRkVXNlcjogZnVuY3Rpb24ob0V2ZW50KXtcblx0XHRcdHRoaXMuX2dldERpYWxvZygpLm9wZW4oKTtcblx0XHRcdHRoaXMuX2xvYWRVc2VyRGF0YSgpO1xuXHRcdH0sXG5cblx0XHRvbkRlbGV0ZVVzZXI6IGZ1bmN0aW9uKG9FdmVudCl7XG5cdFx0XHR2YXIgdGhhdCA9IHRoaXM7XG5cblx0XHRcdHZhciBvQ29udGV4dCA9IG9FdmVudC5nZXRTb3VyY2UoKS5nZXRQYXJlbnQoKS5nZXRCaW5kaW5nQ29udGV4dCgpO1xuXG5cdFx0XHR2YXIgaWQgPSBvQ29udGV4dC5nZXRQcm9wZXJ0eShcImlkXCIpO1xuXG5cdFx0XHQkLmFqYXgoe1xuICAgIFx0XHRcdHVybDogXCIvYXBpL3VzZXIvXCIgKyBpZCxcbiAgICBcdFx0XHR0eXBlOiBcIkRFTEVURVwiXG5cdFx0XHR9KS5kb25lKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdE1lc3NhZ2VUb2FzdC5zaG93KHRoYXQuZ2V0UmVzb3VyY2VCdW5kbGUoKS5nZXRUZXh0KFwibXNnVXNlckRlbGV0ZWRcIiwgW2lkXSkpO1xuXHRcdFx0XHR0aGF0Ll9sb2FkVXNlckRhdGEoKTtcblx0XHRcdH0pLmZhaWwoZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMsIGVycm9yKXtcblx0XHRcdFx0TWVzc2FnZVRvYXN0LnNob3codGhhdC5nZXRSZXNvdXJjZUJ1bmRsZSgpLmdldFRleHQoXCJtc2dFcnJvclwiKSk7XHRcdFx0XHRcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHRvbkNsb3NlQWRkVXNlckRpYWxvZzogZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMuX2dldERpYWxvZygpLmNsb3NlKCk7XG5cdFx0XHR0aGlzLl9nZXREaWFsb2coKS5kZXN0cm95KCk7XG5cdFx0XHRkZWxldGUgdGhpcy5fb0RpYWxvZztcblx0XHR9LFxuXG5cdFx0b25TYXZlQWRkVXNlckRpYWxvZzogZnVuY3Rpb24oKXtcblx0XHRcdHZhciB0aGF0ID0gdGhpcztcblxuXHRcdFx0dmFyIGlkID0gc2FwLnVpLmdldENvcmUoKS5ieUlkKFwiaXBJRFwiKS5nZXRWYWx1ZSgpO1xuXHRcdFx0dmFyIHVzZXJOYW1lID0gc2FwLnVpLmdldENvcmUoKS5ieUlkKFwiaXBVc2VyTmFtZVwiKS5nZXRWYWx1ZSgpO1xuXHRcdFx0dmFyIGxhc3ROYW1lID0gc2FwLnVpLmdldENvcmUoKS5ieUlkKFwiaXBMYXN0TmFtZVwiKS5nZXRWYWx1ZSgpO1xuXHRcdFx0dmFyIGZpcnN0TmFtZSA9IHNhcC51aS5nZXRDb3JlKCkuYnlJZChcImlwRmlyc3ROYW1lXCIpLmdldFZhbHVlKCk7XG5cblx0XHRcdGlmKGlkID09PSBcIlwiIHx8IHVzZXJOYW1lID09PSBcIlwiIHx8IGxhc3ROYW1lID09PSBcIlwiIHx8IGZpcnN0TmFtZSA9PT0gXCJcIil7XG5cdFx0XHRcdE1lc3NhZ2VUb2FzdC5zaG93KHRoYXQuZ2V0UmVzb3VyY2VCdW5kbGUoKS5nZXRUZXh0KFwibXNnUGxlYXNlRW50ZXJBbGxWYWx1ZXNcIikpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdHZhciB1c2VyRGF0YSA9IHtcblx0XHRcdFx0XCJpZFwiOiBpZCxcblx0XHRcdFx0XCJ1c2VyX25hbWVcIjogdXNlck5hbWUsXG5cdFx0XHRcdFwibGFzdF9uYW1lXCI6IGxhc3ROYW1lLFxuXHRcdFx0XHRcImZpcnN0X25hbWVcIjogZmlyc3ROYW1lXG5cdFx0XHR9O1xuXG5cdFx0XHQkLmFqYXgoe1xuICAgIFx0XHRcdHVybDogXCIvYXBpL3VzZXIvXCIsXG4gICAgXHRcdFx0dHlwZTogXCJQT1NUXCIsXG5cdFx0XHRcdGNvbnRlbnRUeXBlOiBcImFwcGxpY2F0aW9uL2pzb25cIiwgXG5cdFx0XHRcdGRhdGE6IEpTT04uc3RyaW5naWZ5KHVzZXJEYXRhKVxuXHRcdFx0fSkuZG9uZShmdW5jdGlvbigpe1xuXHRcdFx0XHRNZXNzYWdlVG9hc3Quc2hvdyh0aGF0LmdldFJlc291cmNlQnVuZGxlKCkuZ2V0VGV4dChcIm1zZ1VzZXJBZGRlZFwiLCBbaWRdKSk7XG5cdFx0XHRcdHRoYXQuX2xvYWRVc2VyRGF0YSgpO1xuXHRcdFx0fSkuZmFpbChmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3Ipe1xuXHRcdFx0XHRNZXNzYWdlVG9hc3Quc2hvdyh0aGF0LmdldFJlc291cmNlQnVuZGxlKCkuZ2V0VGV4dChcIm1zZ0Vycm9yXCIpKTtcdFx0XHRcdFxuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMub25DbG9zZUFkZFVzZXJEaWFsb2coKTtcblx0XHR9LFxuXG5cdFx0b25SZWZyZXNoVXNlcjogZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMuX2xvYWRVc2VyRGF0YSgpO1xuXHRcdH0sXG5cblx0XHRfbG9hZFVzZXJEYXRhOiBmdW5jdGlvbigpe1xuXHRcdFx0dGhpcy5nZXRWaWV3KCkuZ2V0TW9kZWwoKS5sb2FkRGF0YShcIi9hcGkvdXNlclwiKTtcblx0XHR9LFxuXG5cdFx0X2dldERpYWxvZyA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgXHRpZiAoIXRoaXMuX29EaWFsb2cpIHtcbiAgICAgICAgICAgIFx0dGhpcy5fb0RpYWxvZyA9IHNhcC51aS54bWxmcmFnbWVudChcImNvbS51bmlvcmcuY2YuYmFua2luZy5leGFtcGxlLnZpZXcudXNlci5Vc2VyQ3JlYXRlXCIsIHRoaXMpO1xuICAgICAgICAgICAgXHR0aGlzLmdldFZpZXcoKS5hZGREZXBlbmRlbnQodGhpcy5fb0RpYWxvZyk7XG4gICAgICAgICBcdH1cbiAgICAgICAgIFx0cmV0dXJuIHRoaXMuX29EaWFsb2c7XG4gICAgICBcdH1cblxuXHR9KTtcbn0pOyJdfQ==